package main

import (
	"log"
	"os"

	"github.com/kfilin/massage-bot/internal/adapters/mockcalendar"
	"github.com/kfilin/massage-bot/internal/delivery/telegram"
	"github.com/kfilin/massage-bot/internal/health"
	"github.com/kfilin/massage-bot/internal/services/appointment"
)

func main() {
	log.Println("ğŸš€ Massage Bot - Unified Architecture")
	
	// Check for required environment variable
	if os.Getenv("TG_BOT_TOKEN") == "" {
		log.Fatal("âŒ TG_BOT_TOKEN environment variable is required")
	}
	
	log.Println("ğŸ“… Using MOCK calendar adapter")
	
	// Use mock repository adapter
	appointmentRepo := mockcalendar.NewMockRepositoryAdapter()
	appointmentService := appointment.NewService(appointmentRepo)
	
	// Start health server
	go health.StartHealthServer()
	
	// Start bot with the service
	bot := telegram.NewBot(appointmentService)
	
	log.Println("âœ… Bot starting with unified architecture...")
	bot.Start()
}
